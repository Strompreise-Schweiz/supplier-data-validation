{
  "$id": "https://raw.githubusercontent.com/Strompreise-Schweiz/supplier-data-validation/main/tariffs/static/v1/tariff.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "Strompreise Schweiz Static Tariff",
  "type": "object",
  "additionalProperties": false,
  "required": ["name", "prices"],
  "properties": {
    "$schema": { "type": "string", "format": "uri" },
    "name": { "type": "string", "minLength": 1 },
    "description": { "type": "string" },

    "meta": {
      "type": "object",
      "additionalProperties": false,
      "required": ["timezone", "vat_rate_percent"],
      "properties": {
        "timezone": {
          "const": "Europe/Zurich",
          "description": "All timestamps are in Swiss local time (CET/CEST)."
        },
        "vat_rate_percent": {
          "type": "number",
          "description": "Swiss VAT rate in percent, applied to all net prices (all values are stored without VAT).",
          "minimum": 0,
          "maximum": 25
        }
      }
    },

    "electricity_origin": {
      "type": "object",
      "additionalProperties": false,
      "required": ["metric", "by_year"],
      "properties": {
        "definition": { "enum": ["CH_Stromkennzeichnung"] },
        "metric": { "const": "renewable_share_percent" },
        "unit": { "const": "percent" },
        "default_share_percent": { "type": "number", "minimum": 0, "maximum": 100 },
        "by_year": {
          "type": "object",
          "additionalProperties": false,
          "patternProperties": {
            "^(19|20|21)\\d{2}$": {
              "oneOf": [
                { "type": "number", "minimum": 0, "maximum": 100 },
                {
                  "type": "array",
                  "minItems": 4,
                  "maxItems": 4,
                  "items": { "type": "number", "minimum": 0, "maximum": 100 }
                }
              ]
            }
          }
        }
      }
    },

    "prices": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/pricePeriod" }
    }
  },

  "$defs": {
    "hhmm": { "type": "string", "pattern": "^(?:[01]\\d|2[0-3]):[0-5]\\d$" },

    "workItem": {
      "type": "object",
      "additionalProperties": false,
      "required": ["component", "unit", "value"],
      "properties": {
        "component": { "const": "work" },
        "unit": { "const": "CHF/kWh" },
        "value": { "type": "number", "minimum": 0 }
      }
    },

    "powerItem": {
      "type": "object",
      "additionalProperties": false,
      "required": ["component", "unit", "value"],
      "properties": {
        "component": { "const": "power" },
        "unit": {
          "type": "string",
          "pattern": "^CHF\\/kW\\/(?:y|m|w|d|12h|6h|4h|2h|h|30min|15min)$"
        },
        "value": { "type": "number", "minimum": 0 }
      }
    },

    "baseItem": {
      "type": "object",
      "additionalProperties": false,
      "required": ["component", "unit", "value", "mode"],
      "properties": {
        "component": { "const": "base" },
        "unit": {
          "type": "string",
          "pattern": "^CHF\\/(?:y|m|w|d|12h|6h|4h|2h|h|30min|15min)$"
        },
        "value": { "type": "number", "minimum": 0 },
        "mode": { "enum": ["fixed", "min_charge"] }
      }
    },

    "chargeItem": {
      "oneOf": [
        { "$ref": "#/$defs/workItem" },
        { "$ref": "#/$defs/powerItem" },
        { "$ref": "#/$defs/baseItem" }
      ]
    },

    "electricityArray": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/chargeItem" }
    },

    "gridArray": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/chargeItem" }
    },

    "meteringArray": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/baseItem" }
    },

    "dsoArray": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/chargeItem" }
    },

    "integratedArray": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/chargeItem" }
    },

    "feedInArray": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/workItem" }
    },

    "regionalFeesArray": {
      "type": "array",
      "minItems": 1,
      "items": { "$ref": "#/$defs/regionalFeeItem" }
    },

    "override": {
      "type": "object",
      "additionalProperties": false,
      "required": ["weekdays", "intervals", "set"],
      "properties": {
        "name": { "type": "string" },
        "weekdays": {
          "type": "array",
          "minItems": 1,
          "uniqueItems": true,
          "items": { "type": "integer", "minimum": 1, "maximum": 7 }
        },
        "intervals": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "required": ["from", "to"],
            "properties": {
              "from": { "$ref": "#/$defs/hhmm" },
              "to": { "$ref": "#/$defs/hhmm" }
            }
          }
        },
        "set": {
          "type": "object",
          "minProperties": 1,
          "additionalProperties": false,
          "patternProperties": {
            "^(electricity|grid|dso|integrated)\\.(work|power|base)$": {
              "type": "number"
            }
          }
        }
      }
    },

    "pricePeriod": {
      "type": "object",
      "additionalProperties": false,
      "required": [
        "start_timestamp",
        "end_timestamp",
        "electricity",
        "grid",
        "metering",
        "dso"
      ],
      "properties": {
        "start_timestamp": { "type": "string", "format": "date-time" },
        "end_timestamp":   { "type": "string", "format": "date-time" },

        "electricity": { "$ref": "#/$defs/electricityArray" },
        "grid":        { "$ref": "#/$defs/gridArray" },
        "metering":   { "$ref": "#/$defs/meteringArray" },
        "dso":         { "$ref": "#/$defs/dsoArray" },
        "integrated":  { "$ref": "#/$defs/integratedArray" },
        "feed_in":     { "$ref": "#/$defs/feedInArray" },

        "overrides": {
          "type": "array",
          "items": { "$ref": "#/$defs/override" }
        }
      }
    }
  }
}
